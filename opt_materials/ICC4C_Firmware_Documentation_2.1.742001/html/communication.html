<!-- HTML header for doxygen 1.8.16-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="shortcut icon" href="adara_icon.png" type="image/x-icon" />
<title>ICC4C: Communication</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="https://www.optotune.com/" target="_blank"><img alt="Logo" src="optotune_logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ICC4C
   &#160;<span id="projectnumber">143-525-00</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Communication </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >The serial communication is always in one of two modes &ndash; <b>simple</b> mode or <b>protocol</b> mode. In each of these modes, a different set of commands is supported. The default mode active on startup is simple mode. Brief descriptions of the commands available in each mode follow. To see a description of the pro mode error codes, see <a class="el" href="Error.html">Error Codes</a>. Both Simple mode and protocol mode are running as well on Ethernet interface. Description of <b>Ethernet</b> specific features can be found here - <a class="el" href="Ethernet.html">Ethernet features</a></p>
<p ><b>Simple</b> <b>mode</b> <b></b>(ASCII <b>based</b>):</p>
<p >Simple mode is ASCII-based - every command is a sequence of ASCII characters. Every simple mode message (that is, every command to the firmware and every response from the firmware) should end in the sequence CR LF ("\r\n"), that is, two bytes with decimal values 13 and 10. The protocol is not case sensitive and all whitespace is ignored.</p>
<p ><b>Simple</b> <b>mode</b> <b>commands</b> </p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Simple mode commands   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">START[CR][LF]   </td><td class="markdownTableBodyNone">returns "OK", just a simple handshake command to confirm that the communication is working    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">STATUS[CR][LF]   </td><td class="markdownTableBodyNone">returns the status register in hex format, which encodes the status and erros of the device. See <a class="el" href="Status.html">Status</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ACKNOWLEDGE[CR][LF]   </td><td class="markdownTableBodyNone">clears history error flags in the status register. See <a class="el" href="Status.html">Status</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">RESET[CR][LF]   </td><td class="markdownTableBodyNone">resets the device    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GOPRO[CR][LF]   </td><td class="markdownTableBodyNone">switches the serial communication to pro mode with CRC turned off    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">GOPROCRC[CR][LF]   </td><td class="markdownTableBodyNone">switches the serial communication to pro mode with CRC turned on    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GETID[CR][LF]   </td><td class="markdownTableBodyNone">get the firmware serial number    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">GETVERSION[CR][LF]   </td><td class="markdownTableBodyNone">get the firmware version number    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GETSN[CR][LF]   </td><td class="markdownTableBodyNone">get the serial number of the board and the device    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">GETGITSHA1[CR][LF]   </td><td class="markdownTableBodyNone">get the latest git commit hash value (to help identify the specific build)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GOTODFU[CR][LF]   </td><td class="markdownTableBodyNone">Go to device firmware update mode    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SETCHANNEL=%d[CR][LF]   </td><td class="markdownTableBodyNone">select destination/source channel index for setting/getting parameters    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GETCHANNEL[CR][LF]   </td><td class="markdownTableBodyNone">get active channel index    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SETCURRENT=%f[CR][LF]   </td><td class="markdownTableBodyNone">drive selected channel with a current of <em>float</em> milliamperes, <em>float</em> should be in the range todo: (-???.?, ???.?)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GETCURRENT[CR][LF]   </td><td class="markdownTableBodyNone">get actual current setpoint value from selected channel    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SETFP=%f[CR][LF]   </td><td class="markdownTableBodyNone">drive selected channel with a focal power of <em>float</em> dioptre, <em>float</em> should be in the range todo: (-???.?, ???.?)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GETFP[CR][LF]   </td><td class="markdownTableBodyNone">get actual focal power setpoint value from selected channel    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">GETFPMIN[CR][LF]   </td><td class="markdownTableBodyNone">get focal power lower limit value    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GETFPMAX[CR][LF]   </td><td class="markdownTableBodyNone">get focal power upper limit value    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">GETTEMP[CR][LF]   </td><td class="markdownTableBodyNone">get actual temperature for selected channel    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">SETTEMPLIM=%f[CR][LF]   </td><td class="markdownTableBodyNone">set operational temperature limit for selected channel in degrees of Celsius    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">GETDEVICESN[CR][LF]   </td><td class="markdownTableBodyNone">get active device serial number    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DETECTDEVICE[CR][LF]   </td><td class="markdownTableBodyNone">run autodetection of device on active channel, answers with device Name    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SETCURLIMIT=%f;f[CR][LF]   </td><td class="markdownTableBodyNone">set operational current limits for selected channel in mA. First argument is positive limit (0, Max current), second one is negative (- Max current, 0&gt;.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GETCURLIMIT[CR][LF]   </td><td class="markdownTableBodyNone">get operational current limits for selected channel in mA   </td></tr>
</table>
<p ><b>Simple</b> <b>mode</b> <b>answers</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Simple mode answers   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">OK[CR][LF]   </td><td class="markdownTableBodyNone">confirmation that the command was understood and performed    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">NO[CR][LF]   </td><td class="markdownTableBodyNone">invalid command    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">OL[CR][LF]   </td><td class="markdownTableBodyNone">command parameter value below lower limit    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">OU[CR][LF]   </td><td class="markdownTableBodyNone">command parameter value over upper limit    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ERROR[CR][LF]   </td><td class="markdownTableBodyNone">Response of "START" command if there is an active error. Type status to get the status register.   </td></tr>
</table>
<p ><b>Protocol</b> <b>mode:</b> </p>
<p >Pro mode is a byte-based protocol inspired by HDLC. Individual messages are delimited with the "delimiter" byte, 0x7e. To avoid the delimiter byte appearing in the message data, an "escape byte", 0x7d, is also used, and byte stuffing is performed on every message before being sent out (so the receiver should then perform byte destuffing) as follows: Every appearance of the bytes 0x7e or 0x7d in the data (so in a role other than the delimiter or the escape byte) is replaced by the sequence 0x7d 0x5e or 0x7d 0x5d, respectively. In other words, every byte that needs to be escaped is escaped by being XORed with 0x20 and prepended with 0x7d. When destuffing, every instance of 0x7d should be treated as an escape byte - it should not be interpreted as a data byte, it only marks that the following byte should be XORed with 0x20 before being interpreted as another data byte.</p>
<p >Above the delimiting and stuffing layer, every pro mode message has the following format:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Reserved (slave address)   </th><th class="markdownTableHeadNone">Command   </th><th class="markdownTableHeadNone">Data size   </th><th class="markdownTableHeadNone">Data (payload)   </th><th class="markdownTableHeadNone">CRC    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1 byte   </td><td class="markdownTableBodyNone">1 byte   </td><td class="markdownTableBodyNone">1 byte   </td><td class="markdownTableBodyNone">0 - 50 bytes   </td><td class="markdownTableBodyNone">2 bytes   </td></tr>
</table>
<p >The semantics of the individual fields are as follows:</p>
<ul>
<li>Slave address &ndash; this field is currently unused</li>
<li>Command &ndash; a 1-byte unique identifier of the selected command (see below)</li>
<li>Data size &ndash; the number of bytes in the following data field</li>
<li>Data &ndash; the data required by the command / response, limited to 50 bytes</li>
<li>CRC &ndash; the CRC checksum calculated using CRC-16 CCITT algorithm (polynomial seed = 0x1021, initial value = 0xFFFF), present even if CRC is deactivated (the values can be ignored in that case)</li>
</ul>
<p ><b>Available</b> <b>commands:</b> </p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Command name   </th><th class="markdownTableHeadNone">Code   </th><th class="markdownTableHeadNone">Command payload   </th><th class="markdownTableHeadNone">Response payload   </th><th class="markdownTableHeadNone">Note    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Generic command   </td><td class="markdownTableBodyNone">0x00   </td><td class="markdownTableBodyNone">empty   </td><td class="markdownTableBodyNone">empty   </td><td class="markdownTableBodyNone">Used for special purposes, such as error responses to commands with unclear command code    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Get firmware identification   </td><td class="markdownTableBodyNone">0x01   </td><td class="markdownTableBodyNone">empty   </td><td class="markdownTableBodyNone">32bits firmware ID   </td><td class="markdownTableBodyNone">N/A    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Get status   </td><td class="markdownTableBodyNone">0x02   </td><td class="markdownTableBodyNone">empty   </td><td class="markdownTableBodyNone">32bits status register   </td><td class="markdownTableBodyNone">N/A    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Start self-test   </td><td class="markdownTableBodyNone">0x03   </td><td class="markdownTableBodyNone">empty   </td><td class="markdownTableBodyNone">empty   </td><td class="markdownTableBodyNone">N/A    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Load configuration   </td><td class="markdownTableBodyNone">0x04   </td><td class="markdownTableBodyNone">1 byte snapshot id   </td><td class="markdownTableBodyNone">empty   </td><td class="markdownTableBodyNone">3 snapshots are available. 0 is the factory snapshot id.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Store configuration   </td><td class="markdownTableBodyNone">0x05   </td><td class="markdownTableBodyNone">1 byte snapshot id   </td><td class="markdownTableBodyNone">empty   </td><td class="markdownTableBodyNone">3 snapshots are available. Factory snapshot is read only. 2 and 3 can be stored by the user. <br  />
 Snapshot saving takes approximately 200ms, please adjust timeout for communication to 300ms or more.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Set communication mode   </td><td class="markdownTableBodyNone">0x06   </td><td class="markdownTableBodyNone">1 byte mode   </td><td class="markdownTableBodyNone">empty   </td><td class="markdownTableBodyNone">0 for simple mode, unchanged otherwise    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Set value   </td><td class="markdownTableBodyNone">0x10   </td><td class="markdownTableBodyNone">2 bytes register id, 4 bytes value   </td><td class="markdownTableBodyNone">empty   </td><td class="markdownTableBodyNone">see <a class="el" href="architecture.html">Architecture</a> for explanation of Systems and registers    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Get value   </td><td class="markdownTableBodyNone">0x11   </td><td class="markdownTableBodyNone">2 bytes register id   </td><td class="markdownTableBodyNone">4 bytes register value   </td><td class="markdownTableBodyNone">see <a class="el" href="architecture.html">Architecture</a> for explanation of Systems and registers    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Set multiple values   </td><td class="markdownTableBodyNone">0x12   </td><td class="markdownTableBodyNone">2 bytes value count = CNT, 2xCNT bytes register ids, 4xCNT bytes register values   </td><td class="markdownTableBodyNone">empty   </td><td class="markdownTableBodyNone">see <a class="el" href="architecture.html">Architecture</a> for explanation of Systems and registers    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Get multiple values   </td><td class="markdownTableBodyNone">0x13   </td><td class="markdownTableBodyNone">2 bytes value count = CNT, 2xCNT bytes register ids   </td><td class="markdownTableBodyNone">2 bytes value count = CNT, 4xCNT bytes register values   </td><td class="markdownTableBodyNone">see <a class="el" href="architecture.html">Architecture</a> for explanation of Systems and registers    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Set vector   </td><td class="markdownTableBodyNone">0x14   </td><td class="markdownTableBodyNone">2 bytes vector id, 2 bytes index, 1 byte length = SIZE, SIZE bytes data   </td><td class="markdownTableBodyNone">empty   </td><td class="markdownTableBodyNone">see <a class="el" href="architecture.html">Architecture</a> for explanation of Systems and vectors; SIZE bytes starting at the index given are rewritten    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Get vector   </td><td class="markdownTableBodyNone">0x15   </td><td class="markdownTableBodyNone">2 bytes vector id, 2 bytes index, 1 byte length = SIZE   </td><td class="markdownTableBodyNone">SIZE bytes data   </td><td class="markdownTableBodyNone">see <a class="el" href="architecture.html">Architecture</a> for explanation of Systems and vectors; SIZE bytes starting at the index given are read   </td></tr>
</table>
<p ><b>Responses:</b> </p>
<p >Responses have the same format as the commands (possibly with different payload data, see above) with the command code of the response corresponding to the command code of the command being responded to. However, error responses are marked by the most significant bit being set in the command code (in other words, an 0x80 is added to the command code), and the payload should consist of a single 4 byte error flag, see <a class="el" href="Error.html">Error Codes</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<hr class="footer"/><address class="footer"><small>
<a href="https://www.optotune.com/" target="_blank">Optotune. All rights reserved. 
</a>
</small></address>
</body>
</html>
